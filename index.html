<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textquests</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --button-gradient: linear-gradient(45deg, #ff6b6b, #ee5a6f);
            --button-gradient-hover: linear-gradient(45deg, #ee5a6f, #ff6b6b);
            --copy-button-gradient: linear-gradient(45deg, #4ecdc4, #45b7d1);
            --copy-button-gradient-hover: linear-gradient(45deg, #45b7d1, #4ecdc4);
            --copy-button-gradient-copied: linear-gradient(45deg, #96ceb4, #00b894);
            --modal-backdrop: rgba(0, 0, 0, 0.5);
            --text-shadow-strong: 2px 2px 0px #000, -1px -1px 0px #000, 1px -1px 0px #000, -1px 1px 0px #000, 3px 3px 5px rgba(0,0,0,0.5);
            --text-shadow-light: 1px 1px 2px rgba(0, 0, 0, 0.3);
            --text-shadow-medium: 1px 1px 2px rgba(0,0,0,0.8);
            --monospace-font: 'Courier New', 'Monaco', 'Lucida Console', 'Liberation Mono', monospace;
            --border-glass: 1px solid rgba(255,255,255,0.3);
            --background-glass: rgba(255,255,255,0.1);
            --background-glass-hover: rgba(255, 255, 255, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Narrow', 'Arial Black', 'Helvetica Neue', Arial, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
        }

        .container {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }

        .wheel-container {
            position: relative;
            display: inline-block;
            margin-bottom: 40px;
        }

        .wheel {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 8px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            border: var(--border-glass);
            clip-path: polygon(0% 100%, 100% 100%, 100% 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .wheel-segment:hover {
            opacity: 0.8;
        }

        .wheel-segment.disabled {
            cursor: not-allowed;
            pointer-events: none;
        }

        .wheel-segment .segment-text {
            position: absolute;
            width: 140px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
            color: white;
            text-shadow: var(--text-shadow-medium);
            line-height: 1.1;
            transform-origin: center;
            font-family: 'Arial Narrow', 'Helvetica Neue', Arial, sans-serif;
            letter-spacing: -0.3px;
        }

        .wheel-pointer {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 20px solid #fff;
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .spin-button {
            background: var(--button-gradient);
            border: none;
            border-radius: 50px;
            padding: 12px 16px;
            font-size: 1rem;
            font-family: var(--monospace-font);
            font-weight: bold;
            color: #e8eaf6;
            text-shadow: var(--text-shadow-strong);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-block;
            width: auto;
            min-width: fit-content;
            box-sizing: border-box;
        }

        .spin-button:hover {
            background: var(--button-gradient-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .spin-button:active {
            transform: translateY(0);
        }

        .spin-button:disabled {
            background: linear-gradient(45deg, #5ac2ee9c, #6b9affa2);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            background: var(--background-glass);
            backdrop-filter: blur(10px);
            border: var(--border-glass);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-text {
            font-size: 1.3rem;
            font-weight: bold;
            text-shadow: var(--text-shadow-light);
        }

        /* Mobile optimizations */
        @media (max-width: 480px) {
            .wheel {
                width: 320px;
                height: 320px;
            }

            .wheel-segment .segment-text {
                width: 110px;
                font-size: 9px;
            }

            .spin-button {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .result-text {
                font-size: 1.1rem;
            }

            .container {
                padding: 10px;
            }
        }

        @media (max-width: 320px) {
            .wheel {
                width: 280px;
                height: 280px;
            }

            .wheel-segment .segment-text {
                width: 90px;
                font-size: 8px;
            }
        }

        .spinning {
            pointer-events: none;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title {
            font-size: 2.1rem;
            font-family: var(--monospace-font);
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: var(--text-shadow-strong);
            color: #e8eaf6;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 8px 16px;
            background: linear-gradient(45deg, rgba(255,235,59,0.1), rgba(255,193,7,0.1));
            display: inline-block;
        }

        .page-subtitle {
            font-size: 0.8rem;
            font-family: var(--monospace-font);
            font-weight: 300;
            opacity: 0.85;
            color: #e8eaf6;
            letter-spacing: 0.5px;
            font-style: normal;
        }

        @media (max-width: 480px) {
            .page-title {
                font-size: 1.8rem;
                padding: 6px 12px;
                letter-spacing: 1.5px;
            }
            
            .page-subtitle {
                font-size: 0.7rem;
                letter-spacing: 0.4px;
            }
            
            .page-header {
                margin-bottom: 30px;
            }
        }

        @media (max-width: 320px) {
            .page-title {
                font-size: 1.5rem;
                padding: 4px 8px;
                letter-spacing: 1px;
            }
            
            .page-subtitle {
                font-size: 0.6rem;
                letter-spacing: 0.3px;
            }
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-backdrop);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--primary-gradient);
            border-radius: 20px;
            padding: 50px 30px 30px 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            text-align: center;
            animation: modalSlideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #e8eaf6;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .quest-modal-modality {
            font-family: var(--monospace-font);
            font-size: 1rem;
            line-height: 1.3;
            opacity: 0.85;
            margin-bottom: 15px;
            padding: 0 10px;
            text-shadow: var(--text-shadow-light);
        }

        .quest-modal-description {
            font-size: 1.1rem;
            line-height: 1.4;
            text-shadow: var(--text-shadow-light);
            padding: 0 10px;
            margin-bottom: 15px;
        }

        .quest-modal-extra-info, .quest-modal-bonus {
            font-family: var(--monospace-font);
            font-size: 0.8rem;
            line-height: 1.3;
            opacity: 0.85;
            margin-bottom: 15px;
            padding: 0 10px;
            text-shadow: var(--text-shadow-light);
        }

        .quest-modal-copy-quest-button {
            background: var(--copy-button-gradient);
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-family: var(--monospace-font);
            font-weight: bold;
            color: white;
            text-shadow: var(--text-shadow-light);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 5px;
            display: inline-block;
            min-width: 120px;
        }

        .quest-modal-copy-quest-button:hover {
            background: var(--copy-button-gradient-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .quest-modal-copy-quest-button:active {
            transform: translateY(0);
        }

        .quest-modal-copy-quest-button.copied {
            background: var(--copy-button-gradient-copied);
        }


        /* Info button styles */
        .info-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--background-glass);
            border: var(--border-glass);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .info-button:hover {
            background: var(--background-glass-hover);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .info-button:active {
            transform: scale(0.95);
        }

        /* Info modal content styles */
        .info-modal-content {
            font-family: var(--monospace-font);
            font-size: 0.85rem;
            line-height: 1.4;
            opacity: 0.9;
            text-shadow: var(--text-shadow-light);
            white-space: pre-line;
            text-align: left;
            padding: 0 10px;
        }

        /* Copyright text styling */
        .copyright-text {
            display: block;
            font-size: 0.6rem;
            opacity: 0.5;
            margin-top: 15px;
            text-align: center;
            font-style: italic;
        }

        /* Mobile adjustments for info button */
        @media (max-width: 480px) {
            .info-button {
                top: 15px;
                right: 15px;
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        @media (max-width: 320px) {
            .info-button {
                top: 10px;
                right: 10px;
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
        }

        /* Mobile modal adjustments */
        @media (max-width: 480px) {
            .modal {
                padding: 45px 20px 25px 20px;
                margin: 10px;
                border-radius: 15px;
                max-height: 83vh;
            }

            .copy-button {
                font-size: 0.8rem;
                padding: 8px 16px;
                margin-top: 15px;
                min-width: 100px;
            }

            .modal-title {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }

            .modal-content {
                font-size: 1.1rem;
                padding: 0 5px;
            }

            .modal-extra-info, .modal-bonus {
                font-size: 0.7rem;
                margin-top: 12px;
                padding: 0 5px;
            }

            .modal-close {
                top: 10px;
                right: 10px;
                width: 30px;
                height: 30px;
                font-size: 16px;
            }

            .quest-modal-description {
                font-size: 1rem;
            }

            .quest-modal-extra-info, .quest-modal-bonus {
                font-size: 0.7rem;
            }

            .info-modal-content {
                font-size: 0.75rem;
            }

            .copyright-text {
                font-size: 0.55rem;
                margin-top: 12px;
            }
        }

        @media (max-width: 320px) {
            .modal {
                padding: 40px 15px 20px 15px;
                margin: 5px;
            }

            .modal-title {
                font-size: 1.2rem;
            }

            .modal-content {
                font-size: 1rem;
                padding: 0 5px;
            }

            .modal-extra-info, .modal-bonus {
                font-size: 0.6rem;
                margin-top: 10px;
                padding: 0 5px;
            }

            .quest-modal-description {
                font-size: 0.95rem;
            }

            .quest-modal-extra-info, .quest-modal-bonus {
                font-size: 0.65rem;
            }

            .info-modal-content {
                font-size: 0.7rem;
            }

            .copyright-text {
                font-size: 0.5rem;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Info button -->
    <button class="info-button" id="infoButton" title="How to Play" aria-label="Show how to play instructions">‚ÑπÔ∏è</button>
    
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">‚ú® TextQuests ‚ú®</h1>
            <p class="page-subtitle">A game of fun & easy things to do over text!</p>
        </div>
        <div class="wheel-container">
            <div class="wheel-pointer"></div>
            <div class="wheel" id="wheel">
                <!-- Segments will be dynamically generated -->
            </div>
            <div class="center-circle"></div>
        </div>

        <button class="spin-button" id="spinButton" aria-label="Spin the wheel to get a random quest">üé≤ Spin the Wheel!</button>
    </div>

    <!-- Modal for quest results -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <button class="modal-close" id="modalClose" aria-label="Close modal">&times;</button>
            <div class="modal-content" id="modalContent"></div>
        </div>
    </div>

    <script>
        // Configuration constants
        const CONFIG = {
            WHEEL: {
                BASE_FONT_SIZE: 26,
                MIN_FONT_SIZE: 6,
                TEXT_DISTANCE: 32,
                TEXT_WIDTH: 120,
                TEXT_WIDTH_MOBILE: 90,
                TEXT_WIDTH_SMALL: 80
            },
            SPIN: {
                MIN_ROTATIONS: 2,
                MAX_ROTATIONS: 3,
                DURATION: 4000,
                PARTNER_CHOICE_INDEX: 4,
                PARTNER_CHOICE_WEIGHT: 0.22
            },
            CONFETTI: {
                COUNT: 10,
                DELAY: 100,
                DURATION: 3000,
                EMOJIS: ['üéâ', 'üéä', '‚ú®', 'üåü', 'üí´']
            },
            FEEDBACK: {
                COPY_TIMEOUT: 2000
            }
        };

        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spinButton');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalContent = document.getElementById('modalContent');
        const modalClose = document.getElementById('modalClose');
        const infoButton = document.getElementById('infoButton');
        
        // Quest dataclass structure
        class Quest {
            constructor({emoji, modality, description, extraInfo = null, bonus = null}) {
                this.emoji = emoji;
                this.modality = modality;
                this.description = description;
                this.extraInfo = extraInfo;
                this.bonus = bonus;
            }
            
            // Helper method to get formatted text for copying
            getFormattedText() {
                let text = `Your TextQuest is:\n\n${this.emoji} [${this.modality}]\n\n${this.description}`;
                
                if (this.extraInfo) {
                    text += `\n\n‚ÑπÔ∏è ${this.extraInfo}`;
                }
                
                if (this.bonus) {
                    text += `\n\nBONUS: ${this.bonus}`;
                }
                
                return text;
            }
            
            // Helper method to get escaped strings for HTML embedding
            getEscapedStrings() {
                return {
                    description: this.description.replace(/`/g, '\\`').replace(/'/g, "\\'"),
                    extraInfo: this.extraInfo ? this.extraInfo.replace(/`/g, '\\`').replace(/'/g, "\\'") : null,
                    bonus: this.bonus ? this.bonus.replace(/`/g, '\\`').replace(/'/g, "\\'") : null
                };
            }
        }

        let howToPlay = 'üíÅ How to play:\n\nüì±üí¨ ‚è≥ü§∑\n‚ú® TextQuests ‚ú® is played asynchronously with a partner over text.\n\n';
        howToPlay += 'üë§ üîÑ üë§üéØ\nPlayers take turns completing short, accessible challenges (quests) designed to be silly, reflective, or otherwise fun!\n\n';
        howToPlay += 'üé≤üëàüëâü§î‚úÖ\nPlayers can either (1) spin the wheel to receive quest assignments or (2) choose them manually by clicking on wheel segments and selecting their preferences.\n\n';
        howToPlay += 'Copyright 2025, Spinnify';
    
        const quests = [
            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'What is some recent positive trend in your life that you are grateful for/happy about and why?',
                bonus: 'üó£Ô∏è If you were your own biggest fan/advocate, what affirmation or advice would you, in response to hearing about this trend, give to yourself?'
            }),

            new Quest({
                emoji: 'üì∏',
                modality: 'Photo',
                description: 'Share 3-10 pics of some favorite moments from the past 2 years.',
                bonus: "üó£Ô∏è Briefly describe the what/where/when of each photo and, optionally, expound any fun/funny accompanying details/anecdotes."
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'What do you feel is a common misperception about you?',
                extraInfo: "I.e., what is one way that you are sometimes misunderstood?",
                bonus: 'üó£Ô∏è Elaborate for 1+ minutes. E.g.: Why do you think this is? Does it ever bother you? Do you think others interact with you differently as a result?'
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'Share the story of a recent-ish time when you laughed your rear end off (laughed unreasonably hard).',
                bonus: 'üó£Ô∏è How would you describe your sense of humor? || What are the kinds of things that get you laughing the hardest?'
            }),

            new Quest({
                emoji: '‚ùì',
                modality: '...',
                description: 'Your game partner chooses which quest you do!',
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'What do you feel is a side of you that the world doesn\'t often get to see?',
                extraInfo: 'How does this side of you differ from the side(s) that the world does typically see?',
                bonus: 'üó£Ô∏è Elaborate for 1+ minutes.'
            }),

            new Quest({
                emoji: 'üì∏',
                modality: 'Photo',
                description: 'Share a pic+explanation of your favorite part of/thing in your house.',
                bonus: 'üó£Ô∏è Describe your dream house/property. Wide-open spaces? Plants? Convenience? In a world with no global warming or humanitarian issues, what is the first outlandish luxury purchase that you would totally want?'
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'What are some patterns for how you feel connection to/loved by other humans?',
                extraInfo: 'Think about times you\'ve felt seen by, appreciated by, or otherwise connected to friends/others. What were they saying, sharing, or doing that induced this sensation?',
                bonus: 'üó£Ô∏è Conversely, when you feel affinity/connectedness/etc. TOWARDS someone, what actions/expressions tend to come out of (or stay in) you? E.g.:\n\n' +
                    '1Ô∏è‚É£ Hugs, etc. (physical touch gestures)\n2Ô∏è‚É£ Explicitly expressed affirmations\n3Ô∏è‚É£ General warmth/friendliness without explicitly expressed affirmations\n' +
                    '4Ô∏è‚É£ Playfulness in the form of teasing/sarcasm (gentle or even cruel)\n5Ô∏è‚É£ Inclination for symbolic tokens of appreciation (service, gifting, etc.)\n' +
                    '6Ô∏è‚É£ Plain ol\' wanting to share time with/hang around someone‚Äîeven if in silence'
            }),

            new Quest({
                emoji: 'üì∏',
                modality: 'Photo',
                description: 'Share a random, out-of-pocket, or embarrassing pic/vid your camera roll and never talk about it again.',
                extraInfo: 'Your game partner will live in confusion for the rest of their life... muahahaha üòà'
            }),

            new Quest({
                emoji: 'üé∑',
                modality: 'Music/Playlist',
                description: 'Make/share a 5+ song playlist titled "[your name]-core."',
                extraInfo: 'üó£Ô∏è E.g., if your name is Marge, you would make a playlist titled "Marge-core", with 5+ songs that capture your vibe/aesthetic.'
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'Share one or more quirks about how, where, or with whom you grew up.',
                bonus: "üó£Ô∏è Elaborate for 1+ minutes and describe both something positive as well as something negative. How have these things shaped you/your life today?"
            }),

            new Quest({
                emoji: 'üé•',
                modality: 'Video',
                description: 'Share one (or, at max, 2-3) video(s) that bring you joy (YouTube, camera roll, TikTok, etc.).',
                bonus: 'üó£Ô∏è Explain any background/context as needed. || What is it about the video(s) that is so joy-sparking/special to you?'
            }),

            new Quest({
                emoji: 'üì∏',
                modality: 'Photo',
                description: 'With your game partner, see who can take the silliest photo in the next 48 hours.',
                extraInfo: 'ü§ù Although your partner is required to participate, this quest only counts as your turn. After this, your partner will take their next turn as normal.',
                bonus: 'üßë‚Äç‚öñÔ∏è Get a 3rd-party judge involved; the winner gets to give the loser a (kind/reasonable) dare.'
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'Perform a haiku about something that frustrated you today.',
                extraInfo: 'The goofier the haiku/voice used, the better!',
                bonus: 'üó£Ô∏è Add any prelude/post-commentary as needed. || In general, how do you naturally react to or express frustration (e.g., stuffing it down/disassociating, finding someone to vent to, escaping to a comfort place/behavior/food, etc)? How do you wish you reacted instead?'
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'What is one (or more) thing(s) that your game partner doesn\'t/might not know about you?',
                extraInfo: 'It could be anything: a superficial/random thing or even a more pithy/core trait or event in your life.\n\nE.g., what is something that others might see as a nifty hobby/experience/random fact of yours that has just never come up in your interactions?',
                bonus: 'üó£Ô∏è If applicable: what is something that your partner does not, but PROBABLY SHOULD know? That is, given the nature of your relationship, are there any things that might be USEFUL to disclose?'
            }),

            new Quest({
                emoji: 'üì∏',
                modality: 'Photo',
                description: 'Share 1-3 fictional (cartoon, movie, etc.) characters that your game partner reminds you of.',
                bonus: 'üó£Ô∏è Why and in what way(s) do they remind you of each character?'
            }),

            new Quest({
                emoji: 'üó£Ô∏è',
                modality: 'Voice Memo',
                description: 'Share with your game partner 1-3 things you admire or like about them.',
                extraInfo: 'I mean, they must be pretty stinkin\' cool if they\'re playing TextQuests with you!'
            }),

            new Quest({
                emoji: 'üé∑',
                modality: 'Music/Playlist',
                description: 'What are some songs (make a playlist?) that everybody seems to love, but that you just don\'t really get?',
                bonus: 'üó£Ô∏è Conversely, what is a "hot take" song (i.e., weird, controversial, or otherwise not-so-mass-appealing song) that, for some reason, you totally dig?'
            }),

            new Quest({
                emoji: 'üé∑',
                modality: 'Music/Playlist',
                description: 'Make/share a 3+ song playlist titled "[your game partner\'s name]-core."',
                extraInfo: 'E.g., if your partner\'s name is Sam, you would make a playlist titled "Sam-core", with 3+ songs that you think capture their vibe/aesthetic.'
            }),

            new Quest({
                emoji: 'üì∏',
                modality: 'Photo',
                description: 'Share 1+ pic(s) of yourself in some form of costume or goofy apparel.',
                extraInfo: 'E.g., an old Halloween costume, funny sunglasses at the store, etc.',
                bonus: 'üìÖ Make this be a photo that you take in the next 24 hours.'
            }),

        ];
        
        // Colors for the segments (will cycle if more segments than colors)
        const colors = [
            '#ff6b6b',
            '#8750e6',
            '#fd79a8',
            '#ffce47',
            '#4ecdc4',
            '#45b7d1',
            '#ff7675',
            '#6f50d4',
            '#a29bfe',
            '#ff9ff3',
            '#edd377',
            '#96ceb4',
            '#74b9ff',
            '#e17055',
            '#4369b5',
            '#F1B659',
            '#EB9BBA',
            '#54a0ff',
            '#00cec9',
            '#00b894',
        ];
        
        let isSpinning = false;
        let currentRotation = 0;

        // Initialize the wheel
        function createWheel() {
            const numSegments = quests.length;
            const anglePerSegment = 360 / numSegments;
            
            wheel.innerHTML = ''; // Clear existing segments
            
            quests.forEach((quest, index) => {
                const segment = createWheelSegment(quest, index, anglePerSegment);
                wheel.appendChild(segment);
            });
            
            // Reinitialize click listeners after creating segments
            initializeSegmentInteractions();
        }

        // Create a single wheel segment
        function createWheelSegment(quest, index, anglePerSegment) {
            const segment = document.createElement('div');
            segment.className = 'wheel-segment';
            
            const colorIndex = index % colors.length;
            const clipPath = calculateSegmentClipPath(index, anglePerSegment);
            
            // Style the segment
            segment.style.background = colors[colorIndex];
            segment.style.clipPath = `polygon(${clipPath})`;
            segment.style.transform = 'none';
            segment.style.width = '100%';
            segment.style.height = '100%';
            segment.style.position = 'absolute';
            segment.style.border = '1px solid rgba(255,255,255,0.3)';
            
            // Add accessibility attributes
            segment.setAttribute('data-quest-index', index);
            segment.setAttribute('role', 'button');
            segment.setAttribute('tabindex', '0');
            segment.setAttribute('aria-label', `Quest: ${quest.description.substring(0, 50)}...`);
            
            // Create and add text element
            const textElement = createSegmentText(quest, index, anglePerSegment);
            segment.appendChild(textElement);
            
            return segment;
        }

        // Calculate the clip path for a wheel segment
        function calculateSegmentClipPath(index, anglePerSegment) {
            const startAngle = (index * anglePerSegment) - 90; // Start from top
            const endAngle = ((index + 1) * anglePerSegment) - 90;
            
            // Convert angles to radians for calculations
            const startRad = (startAngle * Math.PI) / 180;
            const endRad = (endAngle * Math.PI) / 180;
            
            // Calculate multiple points along the arc for a proper pie slice
            const centerX = 50;
            const centerY = 50;
            const radius = 50;
            
            // Create points for the pie slice - start from center, go to start edge, along arc, back to center
            let clipPathPoints = `50% 50%`; // Start at center
            
            // Add start point
            const x1 = centerX + radius * Math.cos(startRad);
            const y1 = centerY + radius * Math.sin(startRad);
            clipPathPoints += `, ${x1}% ${y1}%`;
            
            // Add points along the arc (more points for smoother curves on wider segments)
            const arcPoints = Math.max(2, Math.ceil(anglePerSegment / 5)); // More points for larger segments
            for (let j = 1; j < arcPoints; j++) {
                const intermediateAngle = startAngle + (anglePerSegment * j / arcPoints);
                const intermediateRad = (intermediateAngle * Math.PI) / 180;
                const xIntermediate = centerX + radius * Math.cos(intermediateRad);
                const yIntermediate = centerY + radius * Math.sin(intermediateRad);
                clipPathPoints += `, ${xIntermediate}% ${yIntermediate}%`;
            }
            
            // Add end point
            const x2 = centerX + radius * Math.cos(endRad);
            const y2 = centerY + radius * Math.sin(endRad);
            clipPathPoints += `, ${x2}% ${y2}%`;
            
            return clipPathPoints;
        }

        // Create the text element for a wheel segment
        function createSegmentText(quest, index, anglePerSegment) {
            const textElement = document.createElement('div');
            textElement.className = 'segment-text';
            textElement.textContent = quest.description;
            
            // Position text in the middle of the segment
            const startAngle = (index * anglePerSegment) - 90;
            const midAngle = startAngle + (anglePerSegment / 2);
            const textDistance = CONFIG.WHEEL.TEXT_DISTANCE;
            const textX = 50 + textDistance * Math.cos((midAngle * Math.PI) / 180);
            const textY = 50 + textDistance * Math.sin((midAngle * Math.PI) / 180);
            
            textElement.style.left = `${textX}%`;
            textElement.style.top = `${textY}%`;
            textElement.style.transform = `translate(-50%, -50%) rotate(${midAngle}deg)`;
            
            // Dynamic font sizing based on text length and number of segments
            const fontSize = calculateDynamicFontSize(quest.description, quests.length);
            textElement.style.fontSize = fontSize + 'px';
            textElement.style.width = CONFIG.WHEEL.TEXT_WIDTH + 'px';
            textElement.style.whiteSpace = 'normal';
            textElement.style.overflow = 'hidden';
            textElement.style.wordBreak = 'break-word';
            
            return textElement;
        }

        // Calculate dynamic font size based on text length and number of segments
        function calculateDynamicFontSize(text, numSegments) {
            const textLength = text.length;
            const baseFontSize = Math.max(8, CONFIG.WHEEL.BASE_FONT_SIZE - numSegments);
            const lengthPenalty = Math.max(0, textLength - 30) * 0.1;
            return Math.max(CONFIG.WHEEL.MIN_FONT_SIZE, baseFontSize - lengthPenalty);
        }

        // Initialize wheel on page load
        createWheel();
        
        // Add click functionality to wheel segments
        function initializeSegmentInteractions() {
            const segments = document.querySelectorAll('.wheel-segment');
            segments.forEach((segment, index) => {
                const handleActivation = (e) => {
                    if (isSpinning) return; // Don't allow activation while spinning
                    e.stopPropagation();
                    showResultModal(quests[index]);
                };

                segment.addEventListener('click', handleActivation);
                
                // Add keyboard support for accessibility
                segment.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        handleActivation(e);
                    }
                });
                
                // Add touch support for mobile
                segment.addEventListener('touchend', (e) => {
                    if (isSpinning) return;
                    e.preventDefault();
                    e.stopPropagation();
                    showResultModal(quests[index]);
                });
            });
        }
        
        // Match button width to title width for symmetry
        function synchronizeButtonLayout() {
            const title = document.querySelector('.page-title');
            const button = document.querySelector('.spin-button');
            if (title && button) {
                const titleWidth = title.offsetWidth;
                button.style.width = titleWidth + 'px';
            }
        }
        
        // Set width on load and resize
        window.addEventListener('load', synchronizeButtonLayout);
        window.addEventListener('resize', synchronizeButtonLayout);

        spinButton.addEventListener('click', spinWheel);

        function spinWheel() {
            if (isSpinning) return;
            
            isSpinning = true;
            spinButton.disabled = true;
            spinButton.textContent = 'üëΩ Spinning...';
            
            // Disable segment clicks while spinning
            const segments = document.querySelectorAll('.wheel-segment');
            segments.forEach(segment => segment.classList.add('disabled'));
            
            // Generate random spin (3-6 full rotations + weighted selection)
            const spins = Math.random() * (CONFIG.SPIN.MAX_ROTATIONS - CONFIG.SPIN.MIN_ROTATIONS) + CONFIG.SPIN.MIN_ROTATIONS;
            
            // Weighted selection: give partner choice quest higher probability
            let selectedIndex;
            const partnerChoiceIndex = CONFIG.SPIN.PARTNER_CHOICE_INDEX;
            const partnerChoiceWeight = CONFIG.SPIN.PARTNER_CHOICE_WEIGHT;
            const otherQuestWeight = (1 - partnerChoiceWeight) / (quests.length - 1);
            
            const random = Math.random();
            if (random < partnerChoiceWeight) {
                selectedIndex = partnerChoiceIndex; // Partner choice quest
            } else {
                // Select from other quests
                const adjustedRandom = (random - partnerChoiceWeight) / (1 - partnerChoiceWeight);
                selectedIndex = Math.floor(adjustedRandom * (quests.length - 1));
                if (selectedIndex >= partnerChoiceIndex) selectedIndex++; // Skip the partner choice index
            }
            
            // Calculate angle to land on selected quest
            const segmentAngle = 360 / quests.length;
            const targetAngle = selectedIndex * segmentAngle + (segmentAngle / 2);
            const finalAngle = (360 - targetAngle) % 360;
            const totalRotation = (spins * 360) + finalAngle;
            
            currentRotation += totalRotation;
            
            // Apply the rotation
            wheel.style.transform = `rotate(${currentRotation}deg)`;
            
            // Calculate result after spin completes
            setTimeout(() => {
                const selectedQuest = quests[selectedIndex];
                
                // Show result in modal
                showResultModal(selectedQuest);
                
                // Reset button state
                spinButton.disabled = false;
                spinButton.textContent = 'üé≤ Spin the Wheel!';
                isSpinning = false;
                
                // Re-enable segment clicks
                segments.forEach(segment => segment.classList.remove('disabled'));
                
                // Add a little celebration effect
                confetti();
            }, CONFIG.SPIN.DURATION);
        }

        function confetti() {
            // Simple confetti effect using emojis
            for (let i = 0; i < CONFIG.CONFETTI.COUNT; i++) {
                setTimeout(() => {
                    const randomEmoji = CONFIG.CONFETTI.EMOJIS[Math.floor(Math.random() * CONFIG.CONFETTI.EMOJIS.length)];
                    createConfettiPiece(randomEmoji);
                }, i * CONFIG.CONFETTI.DELAY);
            }
        }

        function createConfettiPiece(emoji) {
            const confettiPiece = document.createElement('div');
            confettiPiece.textContent = emoji;
            confettiPiece.style.position = 'fixed';
            confettiPiece.style.left = Math.random() * window.innerWidth + 'px';
            confettiPiece.style.top = '-50px';
            confettiPiece.style.fontSize = '24px';
            confettiPiece.style.pointerEvents = 'none';
            confettiPiece.style.zIndex = '1000';
            confettiPiece.style.transition = 'all 3s ease-out';
            
            document.body.appendChild(confettiPiece);
            
            // Animate the confetti falling
            setTimeout(() => {
                confettiPiece.style.top = window.innerHeight + 'px';
                confettiPiece.style.transform = 'rotate(720deg)';
                confettiPiece.style.opacity = '0';
            }, 100);
            
            // Remove the element after animation
            setTimeout(() => {
                document.body.removeChild(confettiPiece);
            }, CONFIG.CONFETTI.DURATION);
        }

        // Modal functions
        function showResultModal(quest) {
            let modalHTML = `<div class="quest-modal-modality">${quest.emoji} [${quest.modality}]</div>`;
            modalHTML += `<div class="quest-modal-description">${quest.description.replace(/\n/g, '<br>')}</div>`;
            if (quest.extraInfo) {
                modalHTML += `<div class="quest-modal-extra-info">‚ÑπÔ∏è ${quest.extraInfo.replace(/\n/g, '<br>')}</div>`;
            } 
            if (quest.bonus) {
                modalHTML += `<div class="quest-modal-bonus">BONUS: ${quest.bonus.replace(/\n/g, '<br>')}</div>`;
            }
            const escaped = quest.getEscapedStrings();
            modalHTML += `<button class="quest-modal-copy-quest-button" onclick="copyQuestUsingHelper(${quests.indexOf(quest)})">Copy Prompt</button>`;
            modalContent.innerHTML = modalHTML;
            modalOverlay.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function hideModal() {
            modalOverlay.classList.remove('show');
            document.body.style.overflow = ''; // Restore scrolling
        }

        function showInfoModal() {
            // Check if copyright text exists and handle it separately
            const hasCopyright = howToPlay.includes('Copyright 2025, Spinnify');
            const mainContent = hasCopyright ? howToPlay.replace('Copyright 2025, Spinnify', '') : howToPlay;
            
            const modalHTML = `
                <div class="info-modal-content">${mainContent}${hasCopyright ? `<span class="copyright-text">Copyright 2025, Spinnify</span>` : ''}</div>
            `;
            modalContent.innerHTML = modalHTML;
            modalOverlay.classList.add('show');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function copyQuestUsingHelper(questIndex) {
            const quest = quests[questIndex];
            const formattedText = quest.getFormattedText();
            copyToClipboard(formattedText);
        }

        function copyQuestText(emoji, modality, description, extraInfo, bonus) {
            let formattedText = `Your TextQuest is:\n\n${emoji} [${modality}]\n\n${description}`;
            
            if (extraInfo) {
                formattedText += `\n\n‚ÑπÔ∏è ${extraInfo}`;
            }
            
            if (bonus) {
                formattedText += `\n\nBONUS: ${bonus}`;
            }
            
            copyToClipboard(formattedText);
        }
        
        async function copyToClipboard(text) {
            try {
                if (navigator.clipboard?.writeText) {
                    await navigator.clipboard.writeText(text);
                    showCopyFeedback();
                    return true;
                }
                return fallbackCopyText(text);
            } catch (error) {
                console.warn('Copy failed:', error);
                return fallbackCopyText(text);
            }
        }

        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopyFeedback();
            } catch (err) {
                console.error('Fallback copy failed: ', err);
                alert('Copy failed. Please manually select and copy the text.');
            }
            
            document.body.removeChild(textArea);
        }

        function showCopyFeedback() {
            const copyButton = document.querySelector('.quest-modal-copy-quest-button');
            if (copyButton) {
                const originalText = copyButton.textContent;
                copyButton.textContent = 'Copied!';
                copyButton.classList.add('copied');
                
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.classList.remove('copied');
                }, CONFIG.FEEDBACK.COPY_TIMEOUT);
            }
        }

        // Modal event listeners
        modalClose.addEventListener('click', hideModal);
        modalOverlay.addEventListener('click', function(e) {
            if (e.target === modalOverlay) {
                hideModal();
            }
        });

        // Info button event listener
        infoButton.addEventListener('click', showInfoModal);

        // Escape key to close modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modalOverlay.classList.contains('show')) {
                hideModal();
            }
        });

        // Touch feedback for mobile
        spinButton.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.95)';
        });

        spinButton.addEventListener('touchend', function() {
            if (!this.disabled) {
                this.style.transform = 'scale(1)';
            }
        });
    </script>
</body>
</html>
